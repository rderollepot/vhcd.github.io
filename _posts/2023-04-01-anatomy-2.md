---
published: false
title: 'Anatomy of a scenario: snowy mountain road'
image: ''
---

A while ago, a researcher at my lab asked me: "Now that we're using Unreal Engine, could we have things like mountain roads? Maybe even with snow?". The answer is yes, and in this blog entry, I'll explain how I implemented this short demo.

<video width="720" height="480" controls>
  <source type="video/mp4"
src="https://cdn.discordapp.com/attachments/692419432210759740/1083794277773103114/rouvieres_neige2.mp4.mp4">
</video>

# Context

Before getting into details, I first need to give some context as to why I ended up making this demo.

In the world of driving simulation, most tools are rather outdated compared to what videogames can be. And in a lab where driving simulation is just another tool used to study cognition, we're not necessarily on the bleeding edge of technology. Our move to Unreal Engine is still quite fresh, and researchers don't necessarily know just *what* can be achieved with it compared to the previous tools they've been using for decades.

But it's not just about showing a glimpse of what's possible to researchers; it's also a way for me to actually learn how to do it. Before making this demo, all the roads I ever created were at a constant height of 0m, and the weather was [sunny all the time always](https://www.youtube.com/watch?v=OhohteHuyPM&t=8s). So even though I was fairly confident that all of this was possible, I might as well make sure it actually is.

# Road

As always, we start with the road. Even though we don't see any asphalt, we still need a road: we need an [OpenDRIVE](/opendrive/) description to make a bunch of things easier, like adding traffic.

Since I know pretty much nothing about mountain roads geometry, I opened [Google Earth Pro](https://www.google.com/earth/versions/#earth-pro) and exported an image of the only mountain road I ever drove on, which is lost somewhere in the middle of gorgeous [Loz√®re](https://en.wikipedia.org/wiki/Loz%C3%A8re).

Then I imported that as a backdrop in [RoadRunner](https://www.mathworks.com/products/roadrunner.html), and just drew over a single ~3.5 km road.

![](/images/rr_backdrop.png)

RoadRunner has very intuitive tools to handle both road altitude and [superelevation](https://www.bigrentz.com/blog/superelevation), which are also both supported in the [OpenDRIVE standard](https://www.asam.net/index.php?eID=dumpFile&t=f&f=4422&token=e590561f3c39aa2260e5442e29e93f6693d1cccd#sec-4abf7baf-fb2f-4263-8133-ad0f64f0feac). For altitude, I got real world values from Google Earth; and for superelevation, I just went with what felt okay.

And that was it for the road. I exported it to Unreal (using [Datasmith](https://www.unrealengine.com/en-US/datasmith)), and I actually never even went back to RoadRunner after the first export. I think I love RoadRunner as much as I hate MATLAB, so it evens out for MathWorks.

# Landscape geometry

The landscape was hand-sculpted using [Unreal's Landscape tools](https://docs.unrealengine.com/5.0/en-US/landscape-quick-start-guide-in-unreal-engine/), which are just super easy to use.

To have the road fit on the landscape, I initially planned on using my OpenDRIVE's plugin fancy [Landscape Sculpting](https://github.com/brifsttar/OpenDRIVE#landscape-sculpting) feature, which kind of worked, but also kind of didn't: though the landscape was mostly lowered/raised correctly, road superelevation wasn't taken into account, which lead to the road levitating on one side, and landscape bleeding through on the other. Not great.

![](/images/rouvieres_good.png)

The reason is that the auto-sculpting feature relies on generating splines that are then fed to [`EditorApplySpline`](https://docs.unrealengine.com/5.1/en-US/BlueprintAPI/Landscape/Editor/EditorApplySpline/) (which, believe it or not, isn't available in C++, only in Blueprint). However, that function doesn't support spline roll (which in our case is superelevation). It has basic start/end roll support, but that wouldn't work for reasons I won't cover here.

So I had to come up with a solution that required me to do some work, *ugh*. Lucky for me, Unreal has [Landscape Splines](https://docs.unrealengine.com/5.0/en-US/landscape-splines-in-unreal-engine/), which are like "advanced splines" that are pretty much made for roads (or rivers). Since documentation on using those in C++ was rather sparse, I browsed through [Unreal's source code](https://docs.unrealengine.com/5.1/en-US/downloading-unreal-engine-source-code/) (which I honestly love being able to do) to get a better understanding how of they're created in editor. And from there it didn't take long for a new [`CreateRoadSplines`](https://github.com/brifsttar/OpenDRIVE/blob/62a5c0d431046a0de4c099c0175b543c463aee20/Source/OpenDRIVEEditor/Private/OpenDrive2Landscape.cpp#L92-L200) [Editor Utility](https://docs.unrealengine.com/5.0/en-US/scripted-actions-in-unreal-engine/) to show up in the OpenDRIVE plugin. Yay!

<video width="720" height="480" controls>
  <source type="video/mp4" src="{{site.baseurl}}/images/rouvieres_splines.mp4.mp4">
</video>

With the Landscape Splines perfectly aligned with road superelevation, aligning the landscape was now just one click away!

## Material, foliage and weather

This section can be sumed up in one word: [Marketplace](https://www.unrealengine.com/marketplace/).

[![](/images/lsm.png)][lsm]

For the landscape material, I used [my favorite one][lsm] which includes 7 layers, foliage, rocks, a gazillion options and is absolutely gorgeous.

Since the "hand-sculpted" part of the landscape unsurprisingly turned out to be quite ugly (remember, I have invested 0 points in the creativity skill tree throughout my life), I figured I might as well hide most of it behind trees. Since the ones from the material mentionned above weren't enough, I hand painted a few from various Marketplace packs using the [Foliage tools](https://docs.unrealengine.com/5.0/en-US/foliage-mode-in-unreal-engine/).

The weather is 100%-default-presets-only [Ultra Dynamic Sky](https://www.unrealengine.com/marketplace/en-US/product/ultra-dynamic-sky), which everybody should own because it's awesome.

# Tire marks



# Cars

Highway filler

# Conclusion

[lsm]: https://www.unrealengine.com/marketplace/en-US/product/landscape-smart-material